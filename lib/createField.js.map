{"version":3,"sources":["createField.js"],"names":["createField","DefaultField","props","Control","control","rest","propTypes","value","any","meta","shape","touched","bool","isRequired","validity","arrayOf","valid","message","string","name","actions","object","Field","mapStateToProps","state","model","format","data","formattedValue","mapDispatchToProps","dispatch","parse","normalize","change","ConnectedField","FormField","shouldComponentUpdate","nextProps","nextState","nextContext","context","componentWillMount","register","componentWillReceiveProps","unregister","componentWillUnmount","render","contextTypes","func","defaultProps","displayName"],"mappings":"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","file":"createField.js","sourcesContent":["/**\n * @file create field\n * @author leon <ludafa@outlook.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport {connect} from 'react-redux';\nimport {getFieldData} from './selectors';\nimport shallowEqual from 'shallow-equal/objects';\nimport createOnChange from './util/createOnChange';\n\n/**\n * DefaultField\n *\n * @class\n * @param {*} props 属性\n */\nfunction DefaultField(props) {\n\n    let {\n        control: Control,\n        ...rest\n    } = props;\n\n    return (\n        <Control {...rest} />\n    );\n\n}\n\nDefaultField.propTypes = {\n    value: PropTypes.any,\n    meta: PropTypes.shape({\n        touched: PropTypes.bool.isRequired\n    }),\n    validity: PropTypes.arrayOf(PropTypes.shape({\n        valid: PropTypes.bool.isRequired,\n        message: PropTypes.string\n    })),\n    name: PropTypes.string.isRequired,\n    actions: PropTypes.object.isRequired\n};\n\nexport default function createField(Field = DefaultField) {\n\n    function mapStateToProps(state, props) {\n\n        const {model, name, format} = props;\n\n        const data = getFieldData(state, model, name);\n\n        const formattedValue = format(data.value, props);\n\n        return formattedValue === data.value\n            ? data\n            : {...data, value: formattedValue};\n    }\n\n    function mapDispatchToProps(dispatch, props) {\n\n        const {\n            parse,\n            normalize,\n            actions\n        } = props;\n\n        const change = createOnChange(actions.change, {parse, normalize});\n\n        return {\n            actions: {\n                ...actions,\n                change,\n                dispatch\n            }\n        };\n    }\n\n    const ConnectedField = connect(mapStateToProps, mapDispatchToProps)(Field);\n\n    /**\n     * FormField\n     *\n     * @class\n     * @param {*} props   属性\n     * @param {Object} context 上下文\n     */\n    class FormField extends Component {\n\n        shouldComponentUpdate(nextProps, nextState, nextContext) {\n            return !shallowEqual(nextProps, this.props)\n                || !shallowEqual(this.context, nextContext);\n        }\n\n        componentWillMount() {\n            this.context.actions.register(this.props.name);\n        }\n\n        componentWillReceiveProps(nextProps, nextContext) {\n\n            if (\n                this.props.name === nextProps.name\n                && nextContext.model === this.context.model\n            ) {\n                return;\n            }\n\n            const {unregister, register} = nextContext.actions;\n\n            unregister(name);\n            register(name);\n\n        }\n\n        componentWillUnmount() {\n            this.context.actions.unregister(this.props.name);\n        }\n\n        render() {\n\n            const {\n                model,\n                actions\n            } = this.context;\n\n            return (\n                <ConnectedField\n                    {...this.props}\n                    actions={actions}\n                    model={model} />\n            );\n        }\n\n    }\n\n    FormField.contextTypes = {\n        actions: PropTypes.object.isRequired,\n        model: PropTypes.string.isRequired\n    };\n\n    FormField.propTypes = {\n        name: PropTypes.string.isRequired,\n        control: PropTypes.func.isRequired,\n        format: PropTypes.func,\n        parse: PropTypes.func,\n        normalize: PropTypes.func\n    };\n\n    FormField.defaultProps = {\n        format(value) {\n            return value == null ? '' : value;\n        }\n    };\n\n    FormField.displayName = `FormField(${Field.displayName || Field.name})`;\n\n    return FormField;\n\n}\n"]}