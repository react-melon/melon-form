{"version":3,"sources":["/src/Form.js"],"names":["Form","props","context","mapStateToProps","bind","mapDispatchToProps","control","getControl","actions","store","dispatch","getChildContext","model","componentWillMount","initialize","componentWillReceiveProps","nextProps","state","getActions","render","rest","createElement","childContextTypes","object","isRequired","string","contextTypes","propTypes","func","validate"],"mappings":"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","file":"Form.js","sourcesContent":["/**\n * @file Form\n * @author leon <ludafa@outlook.com>\n */\n\nimport React, {Component, PropTypes} from 'react';\nimport {bindActionCreators} from 'redux';\nimport createActionCreators from './createActionCreators';\nimport {Provider, connect} from 'react-redux';\nimport {getModel} from './selectors';\nimport shallowEqual from 'shallow-equal/objects';\n\nexport default class Form extends Component {\n\n    constructor(props, context) {\n\n        super(props, context);\n\n        this.mapStateToProps = this.mapStateToProps.bind(this);\n        this.mapDispatchToProps = this.mapDispatchToProps.bind(this);\n\n        this.control = this.getControl(props.control);\n        this.actions = this.mapDispatchToProps(context.store.dispatch, props);\n\n    }\n\n    getChildContext() {\n        return {\n            actions: this.actions.actions,\n            model: this.props.model\n        };\n    }\n\n    componentWillMount() {\n        // 生成 initial value\n        this.actions.actions.initialize();\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        if (shallowEqual(this.props, nextProps)) {\n            return;\n        }\n\n        // 只要属性发生变化，就需要重新生成 actions\n        this.actions = this.mapDispatchToProps(\n            this.context.store.dispatch,\n            nextProps\n        );\n\n        const {model, control} = this.props;\n\n        // 在切换 model 时，要做 initialize\n        if (model !== nextProps.model) {\n            this.actions.actions.initialize();\n        }\n\n        // 切换 control 时要重新 connect 生成组件\n        if (control !== nextProps.control) {\n            this.control = this.getControl(nextProps.control);\n        }\n\n    }\n\n    mapStateToProps(state, props) {\n        return getModel(state, props.model);\n    }\n\n    mapDispatchToProps(dispatch, props) {\n\n        if (this.actions && this.props === props) {\n            return this.actions;\n        }\n\n        let actions = createActionCreators(props);\n\n        if (typeof props.getActions === 'function') {\n\n            actions = {\n                ...actions,\n                ...props.getActions(actions)\n            };\n\n        }\n\n        return {\n            actions: {\n                dispatch,\n                ...bindActionCreators(actions, dispatch)\n            }\n        };\n\n    }\n\n    getControl(control) {\n        return connect(this.mapStateToProps, this.mapDispatchToProps)(control);\n    }\n\n    render() {\n\n        let {model, ...rest} = this.props;\n\n        return React.createElement(\n            this.control,\n            {\n                ...rest,\n                model\n            }\n        );\n\n    }\n\n}\n\nForm.childContextTypes = {\n    actions: PropTypes.object.isRequired,\n    model: PropTypes.string.isRequired\n};\n\nForm.contextTypes = {\n    store: Provider.propTypes.store\n};\n\nForm.propTypes = {\n    model: PropTypes.string.isRequired,\n    control: PropTypes.func.isRequired,\n    validate: PropTypes.func,\n    getActions: PropTypes.func\n};\n"]}